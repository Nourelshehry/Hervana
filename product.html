<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Product - Hervana</title>
  <link rel="stylesheet" href="all-products.css"/>
  <link rel="stylesheet" href="product.css"/>
</head>
<body>

  <!-- Header -->
  <header>
    <!-- Left -->
    <div class="header-actions">
      <button class="back-btn" onclick="window.location.href='all-products.html'">← Back</button>
    </div>

    <!-- Center -->
    <div class="logo">
      <a href="index.html">Hervana</a>
    </div>

    <!-- Right -->
    <div class="header-actions">
      <button id="cart-btn">🛒 <span id="cart-count">0</span></button>
    </div>
  </header>

  <!-- Main Product Section -->
  <main class="product-page" id="product-container">
    <!-- المحتوى بيتبني بالديناميك من product.js -->
  </main>

  <!-- Added to Cart Message -->
  <div id="cart-message" class="cart-message">Added to cart!</div>

  <!-- Sidebar Cart -->
  <aside id="cart-sidebar" class="cart-sidebar">
    <button id="close-cart">✖</button>
    <h2>Your Cart</h2>
    <ul id="cart-items"></ul>
    <button id="checkout-btn">Checkout</button>
  </aside>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox">
    <span class="close-lightbox">&times;</span>
    <img id="lightbox-img" src="" alt="Product preview">
  </div>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 Hervana. All rights reserved.</p>
  </footer>

  <!-- Scripts -->
  <script src="cart.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const productId = new URLSearchParams(window.location.search).get("id");
      const productContainer = document.getElementById("product-container");

      if (!productId) {
        productContainer.innerHTML = "<p>❌ Product not found.</p>";
        return;
      }

      try {
        // ✅ جلب JSON من GitHub
        const response = await fetch("https://raw.githubusercontent.com/Nourelshehry/Hervana/refs/heads/master/products.json");
        const products = await response.json();

        const product = products.find(p => p.id === parseInt(productId));
        if (!product) {
          productContainer.innerHTML = "<p>❌ Product not found.</p>";
          return;
        }

        // ✅ جلب المخزون المحدث من localStorage
        let stockData = JSON.parse(localStorage.getItem("productStock")) || {};
        let currentStock = stockData[product.id] ?? product.stock;

        // ✅ بناء الـ HTML
        productContainer.innerHTML = `
          <div class="product-images">
            <div class="slider-container">
              <div class="slider" id="slider">
                ${product.images.map(img => `<img src="${img}" alt="${product.name}">`).join("")}
              </div>
              <button class="slider-btn prev">❮</button>
              <button class="slider-btn next">❯</button>
              <div class="slider-dots" id="slider-dots"></div>
            </div>
          </div>
          <div class="product-details">
            <h1>${product.name}</h1>
            <p>${product.description}</p>
            <p class="price">EGP ${product.price}</p>
            <p class="stock ${currentStock > 0 ? "in-stock" : "out-of-stock"}">
              ${currentStock > 0 ? `In Stock: ${currentStock}` : "Out of Stock"}
            </p>
            ${
              currentStock > 0
                ? `<button 
                      class="add-to-cart" 
                      data-id="${product.id}"
                      data-name="${product.name}" 
                      data-price="${product.price}"
                      data-stock="${currentStock}"
                    >Add to Cart</button>`
                : `<button disabled>Out of Stock</button>`
            }
          </div>
        `;
      } catch (error) {
        console.error("Error loading product:", error);
        productContainer.innerHTML = "<p>⚠️ Error loading product data.</p>";
      }
    });
  </script>
</body>
</html>
